<!DOCTYPE html>
<html lang="en">
        <style type="text/css">
        /* Global font*/
        header {
            font: bold 34px sans-serif;
        }
        body {
            font: bold 15px sans-serif;
        }
        .axis path,
        .axis line {
                fill: none;
                stroke: black;
                shape-rendering: crispEdges;
                }

        </style>
    <head>
        <meta charset="utf-8">
        <title>2B</title>
        <script type="text/javascript" src="http://d3js.org/d3.v3.js"></script>
    </head>
    
    <body>
		<header>Assignment 2B: Visualizing geodata</header>
        <header>Clustering of prostitution data in San Fransisco</header>
        <p id = "title" align = "center" style="font-size:200%"> Clustering with 2 clusters </p>
        <div id="area1" align="center"></div>
        <p> Change the number of clusters. </p>

        <input type="button" align="center" value="K2" id="K2" onclick="Kfunction('Kmeans2.csv','Centroids2.csv','2')"/>
        <input type="button" align="center" value="K3" id="K3" onclick="Kfunction('Kmeans3.csv','Centroids3.csv','3')"/>
        <input type="button" align="center" value="K4" id="K4" onclick="Kfunction('Kmeans4.csv','Centroids4.csv','4')"/>
        <input type="button" align="center" value="K5" id="K5" onclick="Kfunction('Kmeans5.csv','Centroids5.csv','5')"/>
        <input type="button" align="center" value="K6" id="K6" onclick="Kfunction('Kmeans6.csv','Centroids6.csv','6')"/>
        
        <script type="text/javascript">
        var width = 1200;
        var height = 800;


        var svg = d3.select("#area1")
                    .append("svg")
                    .attr("width",width)
                    .attr("height",height);

        var lightblue = "(135, 206, 250)"
        var label_colors = ["(255,0,0)","(0,255,0)","(0,0,255)","(255,255,0)","(255,0,255)","(255,150,125)"]
        var g = svg.append('g');
        var mapLayer = g.append('g')
        var pointsLayer = g.append('g')
        var centroidLayer = g.append('g')


        d3.json("sfpd.geojson", function(json) {

            var projection = d3.geo.mercator().scale(1).translate([0, 0]).precision(0);
            var path = d3.geo.path().projection(projection);
            var bounds = path.bounds(json);

            xScale = width / Math.abs(bounds[1][0] - bounds[0][0]);
            yScale = height / Math.abs(bounds[1][1] - bounds[0][1]);
            scale = xScale < yScale ? xScale : yScale;

            var transl = [(width - scale * (bounds[1][0] + bounds[0][0])) / 2, (height - scale * (bounds[1][1] + bounds[0][1])) / 2];
                projection.scale(scale).translate(transl);

            mapLayer.selectAll("path")
                .data(json.features)
                .enter()
                .append("path")
                .attr("d", path)
                .style("fill","rgb" + lightblue)
                .style("stroke", "#ffffff");

            
                
            d3.csv('Kmeans2.csv', function(data) {

                //Draw circles
                 pointsLayer.selectAll("circle")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("r",function(d){
                        return 5;
                    })
                    .attr("cx", function (d) { return projection([d.X,0])[0]; })
                    .attr("cy", function (d) { return projection([0,d.Y])[1]; })
                    .attr("fill",function(d){
                        return "rgb" + label_colors[d.labels];
                    });
                    
                    })
            d3.csv("Centroids2.csv", function(data) {
                        
                        //Draw circles
                         centroidLayer.selectAll("circle")
                            .data(data)
                            .enter()
                            .append("circle")
                            .attr("r",function(d){
                                return 10;
                            })
                            .attr("cx", function (d) { return projection([d.Xc,0])[0]; })
                            .attr("cy", function (d) { return projection([0,d.Yc])[1]; })
                            .attr("fill",function(d){
                               if(d.labels > 6){
                                        return "rgb(255,255,255)"

                                    }
                                    else{
                                        return "rgb" + label_colors[d.labels];
                                    }
                            })
                            .attr("stroke-width",2)
                            .style("stroke","black");
                            })


        });

        function Kfunction(datastring,centroids,title){

            document.getElementById("title").innerHTML = "Clustering with " + title + " clusters";

            d3.json("sfpd.geojson", function(json) {

            var projection = d3.geo.mercator().scale(1).translate([0, 0]).precision(0);
            var path = d3.geo.path().projection(projection);
            var bounds = path.bounds(json);

            xScale = width / Math.abs(bounds[1][0] - bounds[0][0]);
            yScale = height / Math.abs(bounds[1][1] - bounds[0][1]);
            scale = xScale < yScale ? xScale : yScale;

            var transl = [(width - scale * (bounds[1][0] + bounds[0][0])) / 2, (height - scale * (bounds[1][1] + bounds[0][1])) / 2];
                projection.scale(scale).translate(transl);


            mapLayer.selectAll("path")
                .data(json.features)
                .enter()
                .append("path")
                .attr("d", path)
                .style("fill","rgb" + lightblue)
                .style("stroke", "#ffffff");
                
            d3.csv(datastring, function(data) {

                //Draw circles
                 pointsLayer.selectAll("circle")
                    .data(data)
                    .transition()
                    .duration(800)
                    .attr("r",function(d){
                        return 5;
                    })
                    .attr("cx", function (d) { return projection([d.X,0])[0]; })
                    .attr("cy", function (d) { return projection([0,d.Y])[1]; })
                    .attr("fill",function(d){
                        return "rgb" + label_colors[d.labels];
                    });
                
                
                    })

            d3.csv(centroids, function(data) {
                
                //Draw circles
                 centroidLayer.selectAll("circle")
                                .data(data)
                                .transition()
                                .duration(800)
                                .attr("r",function(d){
                                    return 10;
                                })
                                .attr("cx", function (d) { return projection([d.Xc,0])[0]; })
                                .attr("cy", function (d) { return projection([0,d.Yc])[1]; })
                                .attr("fill",function(d){
                                    if(d.labels > 6){
                                        return "rgb(255,255,255)"

                                    }
                                    else{
                                        return "rgb" + label_colors[d.labels];
                                    }
                                    
                                });
                    })

            
        });
        };
        </script>
    </body>
</html>